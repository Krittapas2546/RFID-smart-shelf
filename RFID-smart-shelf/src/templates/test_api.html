<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RFID Smart Shelf Interface</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f7f7f7; margin: 0; }
        .container { display: flex; flex-direction: row; justify-content: center; align-items: flex-start; margin-top: 40px; }
        .info-panel { background: #fff; border-radius: 12px; box-shadow: 0 2px 8px #0001; padding: 32px 32px 24px 32px; margin-right: 32px; min-width: 320px; }
        .status-row { display: flex; align-items: center; margin-bottom: 18px; }
        .status-label { font-size: 1.1em; color: #444; margin-right: 8px; }
        .status-badge { background: #6c8cff; color: #fff; border-radius: 8px; padding: 2px 18px; font-weight: bold; font-size: 1.1em; }
        .info-row { margin-bottom: 10px; }
        .info-label { color: #888; font-size: 1em; }
        .lot-number { font-size: 2.5em; font-weight: bold; color: #222; }
        .product-type { font-size: 1.2em; color: #444; }
        .process-info, .stk-info { font-size: 1em; color: #666; margin-bottom: 4px; }
        .shelf-panel { background: #fff; border-radius: 12px; box-shadow: 0 2px 8px #0001; padding: 32px 32px 24px 32px; }
        .shelf-title { font-size: 1.2em; font-weight: bold; margin-bottom: 10px; }
        .shelf-grid { display: grid; grid-template-columns: repeat(4, 40px); grid-template-rows: repeat(6, 40px); gap: 6px; margin-bottom: 10px; }
        .shelf-cell { width: 40px; height: 40px; border: 1.5px solid #bbb; border-radius: 5px; background: #f4f4f4; transition: background 0.2s; position: relative; }
        .shelf-cell:hover { background: #e0eaff; cursor: pointer; }
        .shelf-cell.occupied { background: #ff4d4d; }
        .shelf-cell.from-position { background: #ffe066; }
        .shelf-cell.to-position { background: #5be17a; }
        .level-label { position: absolute; left: -28px; top: 10px; font-size: 0.9em; color: #888; }
        .block-label { text-align: center; font-size: 0.9em; color: #888; margin-bottom: 2px; }
        .control-panel { margin-top: 18px; }
        .update-btn { background: #6c8cff; color: #fff; border: none; border-radius: 6px; padding: 8px 18px; font-size: 1em; cursor: pointer; }
        .update-btn:hover { background: #4a6ed1; }
        .json-input { width: 100%; height: 120px; border-radius: 6px; border: 1px solid #bbb; padding: 8px; font-size: 1em; margin-bottom: 8px; }
        .position-info { margin-top: 10px; font-size: 1em; color: #444; }
    </style>
</head>
<body>
    <div class="container">
        <div class="info-panel">
            <div class="status-row">
                <span class="status-label">Status</span>
                <span class="status-badge" id="status">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">Lot No.</span><br>
                <span class="lot-number" id="lotNo">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">Form</span><br>
                <span class="product-type" id="form">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">Employee ID</span><br>
                <span id="employeeId">-</span>
            </div>
            <div class="info-row">
                <span class="info-label" id="timeStamp">Time Stamp -</span>
            </div>
        </div>
        <div class="shelf-panel">
            <div class="shelf-title">Shelf</div>
            <div class="block-label">
                <span style="display:inline-block;width:40px;">B1</span>
                <span style="display:inline-block;width:40px;">B2</span>
                <span style="display:inline-block;width:40px;">B3</span>
                <span style="display:inline-block;width:40px;">B4</span>
            </div>
            <div class="shelf-grid" id="shelf-grid"></div>
            <div class="position-info" id="positionInfo"></div>
        </div>
    </div>

    <script>
        // รับข้อมูลจาก backend (ถ้ามี)
        const initialData = {{ data | tojson | safe }};

        // สร้าง shelf grid 4x6 (4 blocks, 6 levels)
        function createShelfGrid() {
            const grid = document.getElementById('shelf-grid');
            grid.innerHTML = '';
            for (let row = 0; row < 6; row++) {
                for (let col = 0; col < 4; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'shelf-cell';
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    // แสดง label แถวซ้ายสุด
                    if (col === 0) {
                        const levelLabel = document.createElement('span');
                        levelLabel.className = 'level-label';
                        levelLabel.innerText = `L${row + 1}`;
                        cell.appendChild(levelLabel);
                    }
                    cell.onclick = function() {
                        showPositionInfo(row, col);
                    };
                    grid.appendChild(cell);
                }
            }
        }

        function showPositionInfo(row, col) {
            document.getElementById('positionInfo').innerText = `Level: ${row + 1}, Block: ${col + 1}`;
        }

        function clearPositionInfo() {
            document.getElementById('positionInfo').innerText = '';
        }

        // อัปเดตข้อมูลบนหน้าเว็บ
        function renderData(data) {
            document.getElementById('status').innerText = data.Status || '-';
            document.getElementById('lotNo').innerText = data.LotNo || '-';
            document.getElementById('form').innerText = data.Form || '-';
            document.getElementById('employeeId').innerText = data.EmployeeID || '-';
            document.getElementById('timeStamp').innerText = `Time Stamp ${data.TimeStamp || '-'}`;

            // อัปเดตชั้นวาง
            const shelfGrid = document.getElementById('shelf-grid');
            const cells = shelfGrid.getElementsByClassName('shelf-cell');
            // รีเซ็ต
            for (const cell of cells) {
                cell.classList.remove('occupied', 'from-position', 'to-position');
            }
            // ระบายสีช่องที่มีสินค้า
            if (data.ShelfPositions) {
                data.ShelfPositions.forEach(pos => {
                    const row = pos[0];
                    const col = pos[1];
                    const cellIndex = row * 4 + col;
                    if (cells[cellIndex]) {
                        cells[cellIndex].classList.add('occupied');
                    }
                });
            }
        }

        window.onload = function() {
            createShelfGrid();
            clearPositionInfo();
            if (typeof initialData !== 'undefined' && initialData) {
                renderData(initialData);
            }
        };
    </script>